// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.1/esri/copyright.txt for details.
//>>built
define("./internal/MaterialUtil ../lib/Util ../lib/gl-matrix ../lib/RenderSlot ../lib/DefaultVertexBufferLayouts ../../../webgl/Util".split(" "),function(v,w,x,E,F,G){var a=x.vec3d,y=x.vec2d,z=x.mat4d,H=w.VertexAttrConstants,b=a.create(),c=a.create(),g=a.create(),t=a.create(),q=y.create(),r=y.create(),A=a.create(),B=a.create(),k=function(C,D,p,u){"string"===typeof p&&(u=p,p=void 0);v.basicMaterialConstructor(this,u);this.lineType=p||k.LINES;var l=F.Pos3,s=G.getStride(l)/4;this.canBeMerged=this.lineType===
k.LINES;this.setColor=function(d){D=d;this.notifyDirty("matChanged")};this.getColor=function(){return D};this.dispose=function(){};this.getOutputAmount=function(d){d=d/2+1;if(this.lineType===k.STRIP)return d*s;if(this.lineType===k.LINES)return(2*d-2)*s};this.getVertexBufferLayout=function(){return l};this.fillInterleaved=function(d,a,f,l,b,c){d=d.vertexAttr[H.POSITION].data;if(a||this.lineType===k.LINES){l=d.length/3;for(f=0;f<l;f++){var h=3*f,e=d[h],m=d[h+1],n=d[h+2];if(a)var h=e,g=m,e=a[0]*h+a[4]*
g+a[8]*n+a[12],m=a[1]*h+a[5]*g+a[9]*n+a[13],n=a[2]*h+a[6]*g+a[10]*n+a[14];b[c++]=e;b[c++]=m;b[c++]=n;this.lineType===k.LINES&&(0!==f&&f!==l-1)&&(b[c++]=e,b[c++]=m,b[c++]=n)}}else for(f=0;f<d.length;f++)b[c++]=d[f]};this.intersect=function(d,l,f,p,k,s,h,e,m,n,u,C){if(C){d=d.getData().getVertexAttr("position").position.data;l=Number.MAX_VALUE;for(h=0;h<d.length-5;h+=3){b[0]=d[h];b[1]=d[h+1];b[2]=d[h+2];z.multiplyVec3(f,b);c[0]=d[h+3];c[1]=d[h+4];c[2]=d[h+5];z.multiplyVec3(f,c);m.projectPoint(b,q);m.projectPoint(c,
r);if(0>q[2]&&0<r[2])a.subtract(b,c,g),e=m.frustumPlanes,n=-(a.dot(e[4],b)+e[4][3]),e=n/a.dot(g,e[4]),a.scale(g,e,g),a.add(b,g,b),m.projectPoint(b,q);else if(0<q[2]&&0>r[2])a.subtract(c,b,g),e=m.frustumPlanes,n=-(a.dot(e[4],c)+e[4][3]),e=n/a.dot(g,e[4]),a.scale(g,e,g),a.add(c,g,c),m.projectPoint(c,r);else if(0>q[2]&&0>r[2])continue;e=w.projectVectorVector2D(q,r,p);e<l&&(l=e,a.set(b,A),a.set(c,B))}2>l&&(f=w.linelineDistance3D(A,B,k,s),p=Number.MAX_VALUE,f[0]&&(a.subtract(f[2],k,t),f=a.length(t),a.scale(t,
1/f),p=0.98*f/a.dist(k,s)),u(p,t))}};this.getGLMaterials=function(){return{color:I,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};this.getAllTextureIds=function(){return[]}};k.STRIP=1;k.LINES=2;var I=function(a,b){v.basicGLMaterialConstructor(this,a);var c=b.get("simple"),g=a.getColor();this.beginSlot=function(a){return a===E.OPAQUE_MATERIAL};this.getProgram=function(){return c};this.bind=function(a,b){a.bindProgram(c);c.setUniform4fv("color",g);1>g[3]&&a.setBlendingEnabled(!0)};
this.release=function(a){1>g[3]&&a.setBlendingEnabled(!1)};this.bindView=function(a,b){v.bindView(b.origin,b.view,c)};this.bindInstance=function(a,b){c.setUniformMatrix4fv("model",b.transformation)};this.getDrawMode=function(b){b=b.gl;return a.lineType===k.STRIP?b.LINE_STRIP:b.LINES}};return k});