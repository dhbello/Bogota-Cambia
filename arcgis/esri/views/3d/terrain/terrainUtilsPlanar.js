// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.1/esri/copyright.txt for details.
//>>built
define("require exports ./TilingScheme ./TerrainConst ../../../core/Error ../../../geometry/support/scaleUtils ../support/aaBoundingRect ../lib/glMatrix".split(" "),function(x,m,q,r,p,u,n,v){function k(c,b,e,a){d.set(e,l);l[a]=b[a];a=d.subtract(l,b);var f=d.subtract(c,b,w),f=d.dot(f,a),s=d.dot(a,a);b=0>=f?b:s<=f?e:d.add(b,d.scale(a,f/s),l);c=d.subtract(c,b,l);return Math.PI/2-Math.atan(c[2]/Math.sqrt(c[0]*c[0]+c[1]*c[1]))}function t(c,b){var e=c.getElevationBounds(),a=c.extent,e=0.5*(e[0]+e[1]);h[0]=
a[0];h[1]=a[1];h[2]=e;g[0]=a[2];g[1]=a[3];g[2]=e;e=a=Infinity;b[0]<h[0]?a=k(b,h,g,0):b[0]>g[0]&&(a=k(b,g,h,0));b[1]<h[1]?e=k(b,h,g,1):b[1]>g[1]&&(e=k(b,g,h,1));return Math.min(a,e)}var d=v.vec3d,l=d.create(),w=d.create(),h=d.create(),g=d.create();m.autoUpdateSkirtsVisibility=function(c,b){var e,a=!0,f=c.extent,d=n.contains(f,b);d?e=c.getElevation(b):(e=c.getElevationBounds(),e=0.5*(e[0]+e[1]));e>b[2]?a=!1:d||(d=Math.min(f[2]-f[0],f[3]-f[1]),n.containsWithMargin(f,b,c.hideSkirtsDistanceFromExtentMargin*
d)?t(c,b)>c.hideSkirtsMinimumCameraTilt&&(a=!1):a=!1);a!==c.skirts&&(c.skirts=a)};m.tiltOnEdge=k;m.tiltToExtentEdge=t;m.checkIfTileInfoSupportedForViewSR=function(c,b,e){if(null==u.getUnitValue(c.spatialReference))return new p("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var a=q.checkUnsupported(c);if(a)return a;var f=c.lods,a=f[0].resolution*Math.pow(2,f[0].level),d=[a*c.size[0],a*c.size[1]],h=[c.origin.x,c.origin.y];b=n.fromExtent(b);
var g=n.create();q.computeRowColExtent(b,d,h,g);d=(g[2]-g[0])*(g[3]-g[1]);d>r.MAX_ROOT_TILES?(f=f[0].scale*Math.pow(2,f[0].level),a=Math.max((b[3]-b[1])/c.size[1],(b[2]-b[0])/c.size[0])*f/a,b=Math.floor(Math.log(a)/Math.log(10)),a=Math.ceil(a/Math.pow(10,b))*Math.pow(10,b),a=new p("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(f).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+a.toLocaleString()+".",{level0Scale:f,suggestedLevel0Scale:a,
requiredNumRootTiles:d,allowedNumRootTiles:r.MAX_ROOT_TILES})):a=null;return a?a:!c.spatialReference.equals(e)?new p("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}});