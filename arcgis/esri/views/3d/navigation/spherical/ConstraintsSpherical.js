// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.1/esri/copyright.txt for details.
//>>built
define("../mixins/ConstraintsMixin ../../support/mathUtils ../../support/earthUtils ../../lib/glMatrix ../../constraints/SceneViewAltitudeConstraint ../../constraints/SceneViewTiltConstraint ../../webgl-engine/lib/Util".split(" "),function(k,f,h,q,n,m,r){var g=q.vec3d,l=g.create();return k.createSubclass({declaredClass:"esri.views.3d.navigation.spherical.ConstraintsSpherical",defaultConstraints:{tilt:new k.Tilt({min:function(){return f.deg2rad(m.MAX_DEFAULT)},max:f.makePiecewiseLinearFunction([[4E3,
f.deg2rad(m.MIN_DEFAULT)],[5E4,f.deg2rad(88)],[6E6,f.deg2rad(88)],[2E7,f.deg2rad(m.MAX_DEFAULT)]])}),altitude:new k.Altitude({min:function(){return n.MIN_DEFAULT},max:function(){return n.MAX_DEFAULT}}),collision:new k.Collision},initialize:function(){this.captainNemoAltitudeThreshold=2E4;this.captainNemoElevationThreshold=-500},limitAltitude:function(a,b,c,d){g.scale(c,a/d,l);g.subtract(b,l,l);var e=this.renderCoordsHelper.getAltitude(l),f=this.constraints.altitude.apply(this,e);if(1E-6<Math.abs(e-
f)){a=g.length(b);f+=h.earthRadius;b=g.dot(c,b)/(a*d);b*=-2*a;c=b*b-4*(-(f*f)+a*a);if(0>c)return this.minPoiDist;c=Math.sqrt(c);return c<b?(b-c)/2:(c-b)/2}return a},limitTiltByAltitudeConstraints:function(a,b,c,d){b=g.length(b);var e=b*b,k=c*c,l=Math.sqrt(e+k-2*b*c*Math.cos(Math.PI-a))-h.earthRadius,m=this.constraints.altitude.min(),n=this.constraints.altitude.max(),p;if((void 0===d||0<d)&&l<m)p=m;else if((void 0===d||0>d)&&l>n)p=n;void 0!==p&&(a=p+h.earthRadius,a=Math.PI-f.acos((-(a*a)+e+k)/(2*b*
c)));return a},distanceToSilhouette:function(a,b,c,d,e){e||(e={maxFarNearRatio:0,distance:0});a=g.dot(a.eye,a.eye);b=h.earthRadius*h.earthRadius;e.maxFarNearRatio=this.maxFarNearRatio;this.isNemoMode(a,d)?(d=h.earthRadius+d,e.distance=Math.sqrt(a-d*d)):a>b?(e.maxFarNearRatio=f.clamp(2E4-19E3*((Math.log(Math.sqrt(a)-h.earthRadius)-7.983)/9.011),1E3,2E4),e.distance=Math.sqrt(a-b)):e.distance=this.maxFarNearRatio*this.minNearDistance;e.distance*=1.2;return e},isNemoMode:function(a,b){var c=h.earthRadius+
this.captainNemoAltitudeThreshold;return a<c*c&&b<this.captainNemoElevationThreshold},intersectManifold:function(a,b,c,d){return r.raySphereClosestPositive(a,b,h.earthRadius+c,d)},getFallbackCenterAlongViewDirection:function(a,b,c){var d=g.dot(a,a),e=h.earthRadius*h.earthRadius,d=d>e?Math.sqrt(d-e)/3:1;g.subtract(b,a,c);g.scale(c,d/g.length(c),c);g.add(c,a)}})});