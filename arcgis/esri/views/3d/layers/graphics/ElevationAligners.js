// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.1/esri/copyright.txt for details.
//>>built
define("../../../../geometry/Point ../../lib/glMatrix ../../support/projectionUtils ../../webgl-engine/lib/Util ./Graphics3DSymbolCommonCode ./graphicUtils".split(" "),function(x,e,y,z,s,A){var B=z.VertexAttrConstants;e=e.vec3d;var p=new x,f=e.create(),c=e.create(),n=e.create(),r={perVertexElevationAligner:function(g,a,h){var k=g.stageObject;g=g.elevationInfo;p.spatialReference=a.spatialReference;for(var t=k.getGeometryRecords(),C=t.length,m=0;m<C;m++){var b=t[m].geometry,l=t[m].transformation;c[0]=
l[12];c[1]=l[13];c[2]=l[14];b.invalidateBoundingInfo();for(var l=b.getData().getVertexAttr(),b=l[B.POSITION].data,l=l.mapPos.data,e=b.length/2,d=0,u=0,v=!1,w=0;w<e;w++){p.x=l[u++];p.y=l[u++];p.z=l[u++];n[0]=b[d];n[1]=b[d+1];n[2]=b[d+2];var q=s.computeElevation(a,p,g);f[0]=b[d]+c[0];f[1]=b[d+1]+c[1];f[2]=b[d+2]+c[2];h.setAltitude(q,f,0);b[d]=f[0]-c[0];b[d+1]=f[1]-c[1];b[d+2]=f[2]-c[2];q=r.updateThresholdInMeters/h.unitInMeters;if(Math.abs(n[0]-b[d])>=q||Math.abs(n[1]-b[d+1])>=q||Math.abs(n[2]-b[d+
2])>=q)v=!0;d+=3}v&&k.geometryVertexAttrsUpdated(m)}},perObjectElevationAligner:function(g,a,h){var k=g.elevationInfo,c=k.centerPointInElevationSR,e=0;if(g.stageObject.metadata.usesVerticalDistanceToGround){var m={verticalDistanceToGround:0},e=s.computeElevation(a,c,k,m);A.updateVertexAttributeAuxpos1w(g.stageObject,m.verticalDistanceToGround)}else e=s.computeElevation(a,c,k);a=g.stageObject.getObjectTransformation();k=[a[12],a[13],a[14]];r.iterativeUpdatesEnabled?h.setAltitudeOfTransformation(e,
a):(f[0]=c.x,f[1]=c.y,f[2]=e,y.computeLinearTransformation(c.spatialReference,f,a,h.spatialReference)&&g.stageObject.setObjectTransformation(a));h=r.updateThresholdInMeters/h.unitInMeters;(Math.abs(a[12]-k[0])>=h||Math.abs(a[13]-k[1])>=h||Math.abs(a[14]-k[2])>=h)&&g.stageObject.setObjectTransformation(a)},updateThresholdInMeters:0.01,iterativeUpdatesEnabled:!0};return r});