// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.1/esri/copyright.txt for details.
//>>built
define("../../config ../../core/Accessor ../../core/Error ../../core/Evented ../../core/promiseUtils ../../geometry/Point ../../geometry/support/webMercatorUtils ../../Graphic ../../portal/Portal ../../symbols/PictureMarkerSymbol ../../tasks/GeometryService ../../tasks/support/ProjectParameters dojo/_base/lang require".split(" "),function(f,k,g,l,d,m,n,p,q,r,s,t,h,u){return k.createSubclass([l],{properties:{geolocationOptions:{},goToLocationEnabled:{},graphic:{type:p},view:{}},declaredClass:"esri.widgets.support.GeolocationPositioning",
getDefaults:function(){return h.mixin(this.inherited(arguments),{geolocationOptions:{maximumAge:0,timeout:15E3,enableHighAccuracy:!0},graphic:{}})},initialize:function(){navigator.geolocation?window.hasOwnProperty("isSecureContext")&&!window.isSecureContext&&(console.log(this.declaredClass,"navigator.geolocation requires a secure origin."),this._geolocationUsable=!1):(console.log(this.declaredClass,"navigator.geolocation unsupported."),this._geolocationUsable=!1)},destroy:function(){this._clear()},
_geolocationUsable:!0,_iconPath:"../../images/support/sdk_gps_location.png",geolocationOptions:null,goToLocationEnabled:!0,graphic:null,_graphicSetter:function(a){a&&!a.symbol&&(a.symbol=new r({url:u.toUrl(this._iconPath),width:21,height:21}));this._set("graphic",a)},view:null,_clear:function(){this.view&&this.view.graphics.remove(this.graphic)},_positionToObject:function(a){return a?{coords:h.mixin({},a.coords),timestamp:a.timestamp}:{}},_getGeometryServiceUrl:function(){if(f.geometryServiceUrl)return d.resolve(f.geometryServiceUrl);
var a=q.getDefault();return a.load().always(function(){return a.get("helperServices.geometry.url")})},_projectPoint:function(a){var c=this.get("view.spatialReference");return c.isWGS84?d.resolve(a):c.isWebMercator?d.resolve(n.geographicToWebMercator(a)):this._getGeometryServiceUrl().then(function(b){if(!b)return d.reject(g("geometry-service:missing-url","Geometry service URL is missing"));b=new s({url:b});var e=new t({geometries:[a],outSR:c});return b.project(e).then(function(a){return a[0]})})},
_getScale:function(a){a=a&&a.coords&&a.coords.accuracy;return this.scale||a||5E4},_createPoint:function(a){a=a&&a.coords;return!a?null:new m({longitude:a.longitude,latitude:a.latitude,z:a.altitude||null,spatialReference:{wkid:4326}})},_animatePoint:function(a,c,b){return!this.goToLocationEnabled?d.resolve(c):this.view.goTo({target:a,scale:b}).then(function(){return c})},_setPosition:function(a){a=this._positionToObject(a);var c=this.graphic,b=this._createPoint(a);b&&(c.geometry=b);var e=this._getScale(a);
return b?this._projectPoint(b).then(function(b){return this._animatePoint(b,a,e,c)}.bind(this)).then(function(){return a}):d.reject(g("positioning:invalid-point","Cannot position invalid point"))}})});