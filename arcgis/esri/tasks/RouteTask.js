// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.1/esri/copyright.txt for details.
//>>built
define("../geometry/support/normalizeUtils ../Graphic ../request ./support/NAMessage ./support/RouteResult ./Task ./support/NAServiceDescription dojo/Deferred dojo/_base/array dojo/_base/lang".split(" "),function(u,v,w,x,y,e,z,l,m,k){e=e.createSubclass([z],{declaredClass:"esri.tasks.RouteTask",__msigns:[{n:"solve",c:1,a:[{i:0,p:["stops.features","barriers.features","polylineBarriers.features","polygonBarriers.features"]}],e:2}],properties:{parsedUrl:{get:function(){var f=this._parseUrl(this.url);
f.path+="/solve";return f}},url:{}},solve:function(f,c){var b=new l,a=new l,e=this.__msigns[0].a[0].p,g=c&&c.assembly&&c.assembly[0]||{};this._isInputGeometryZAware(g,e)?a=this.getServiceDescription():a.resolve({dontCheck:!0});a.then(k.hitch(this,function(a){!a.hasZ&&!a.dontCheck&&this._dropZValuesOffInputGeometry(g,e);a=this._encode(k.mixin({},this.parsedUrl.query,{f:"json"},f.toJSON(g)));w(this.parsedUrl.path,{query:a,callbackParamName:"callback"}).then(k.hitch(this,function(a){b.resolve(this._handleSolveResponse(a))}),
b.reject)}),b.reject);return b.promise},_handleSolveResponse:function(f){var c=[],b=[],a=f.data,e=a.routes?a.routes.features:[],g=a.stops?a.stops.features:[];f=a.barriers?a.barriers.features:[];var k=a.polygonBarriers?a.polygonBarriers.features:[],l=a.polylineBarriers?a.polylineBarriers.features:[],n=a.messages,h=m.forEach,p=m.indexOf,q=!0,d,r,s=a.routes&&a.routes.spatialReference||a.stops&&a.stops.spatialReference||a.barriers&&a.barriers.spatialReference||a.polygonBarriers&&a.polygonBarriers.spatialReference||
a.polylineBarriers&&a.polylineBarriers.spatialReference;h(a.directions||[],function(a){c.push(d=a.routeName);b[d]={directions:a}});h(e,function(a){if(-1===p(c,d=a.attributes.Name))c.push(d),b[d]={};b[d].route=a});h(g,function(a){r=a.attributes;if(-1===p(c,d=r.RouteName||"esri.tasks.RouteTask.NULL_ROUTE_NAME"))c.push(d),b[d]={};"esri.tasks.RouteTask.NULL_ROUTE_NAME"!==d&&(q=!1);void 0===b[d].stops&&(b[d].stops=[]);b[d].stops.push(a)});0<g.length&&!0===q&&(b[c[0]].stops=b["esri.tasks.RouteTask.NULL_ROUTE_NAME"].stops,
delete b["esri.tasks.RouteTask.NULL_ROUTE_NAME"],c.splice(m.indexOf(c,"esri.tasks.RouteTask.NULL_ROUTE_NAME"),1));var t=[];h(c,function(a,c){b[a].routeName="esri.tasks.RouteTask.NULL_ROUTE_NAME"===a?null:a;b[a].spatialReference=s;t.push(y.fromJSON(b[a]))});a=function(a){h(a,function(b,c){b.geometry&&(b.geometry.spatialReference=s);a[c]=v.fromJSON(b)});return a};h(n,function(a,b){n[b]=x.fromJSON(a)});return{routeResults:t,barriers:a(f),polygonBarriers:a(k),polylineBarriers:a(l),messages:n}}});u._createWrappers(e);
return e});