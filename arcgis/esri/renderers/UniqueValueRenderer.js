// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/4.1/esri/copyright.txt for details.
//>>built
define("../core/declare ../core/lang dojo/_base/array dojo/_base/lang ../symbols/support/jsonUtils ./Renderer".split(" "),function(k,d,f,g,e,l){var h=k(l,{declaredClass:"esri.renderer.UniqueValueRenderer",properties:{type:"uniqueValue",field:{value:null,json:{readFrom:["field1"],read:function(a,b){return b.field1},writeTo:"field1"}},field2:{value:null,json:{writable:!0}},field3:{value:null,json:{writable:!0}},expression:{value:null,json:{writable:!0}},expressionTree:{value:null,dependsOn:["expression"],
get:function(){return this.expression?this._parseExpr(this.expression,{vars:{$feature:"any"}}):null}},defaultLabel:{value:null,json:{writable:!0}},defaultSymbol:{value:null,json:{read:e.read,write:function(a,b,c){if(a=e.write(a,{},c))b.defaultSymbol=a}}},fieldDelimiter:{value:null,json:{writable:!0}},uniqueValueInfos:{set:function(a){this._symbols={};f.forEach(a,this._processUVInfo,this);this._set("uniqueValueInfos",a)},json:{read:function(a,b,c){if(a&&Array.isArray(a))return a.map(function(a){a=
d.clone(a);a.symbol=e.read(a.symbol,b,c);return a})},write:function(a,b,c){b.uniqueValueInfos=f.map(this.uniqueValueInfos||[],function(a){a=d.clone(a);a.symbol&&(a.symbol=e.write(a.symbol,{},c));a.value+="";return d.fixJson(a)})}}},requiredFields:{dependsOn:["field","field2","field3"]}},constructor:function(){this._symbols={};this.uniqueValueInfos=[]},addUniqueValueInfo:function(a,b){var c=g.isObject(a)?a:{value:a,symbol:b};this.uniqueValueInfos.push(c);this._processUVInfo(c)},removeUniqueValueInfo:function(a){var b=
-1;f.some(this.uniqueValueInfos,function(c,d){if(c.value==a)return b=d,!0});-1!==b&&(delete this._symbols[a],this.uniqueValueInfos.splice(b,1))},getUniqueValueInfo:function(a){var b=this.field,c=a.attributes,d,e;this.expression?b=this._executeExpr(this.expressionTree,this._createExprContext(a)):this.field2?(a=this.field2,d=this.field3,e=[],b&&e.push(c[b]),a&&e.push(c[a]),d&&e.push(c[d]),b=e.join(this.fieldDelimiter||"")):b=g.isFunction(b)?b(a):c[b];return this._symbols[b]},getSymbol:function(a){return(a=
this.getUniqueValueInfo(a))&&a.symbol||this.defaultSymbol},clone:function(){return new h({field:this.field,field2:this.field2,field3:this.field3,defaultLabel:this.defaultLabel,defaultSymbol:this.defaultSymbol&&this.defaultSymbol.clone(),expression:this.expression,fieldDelimiter:this.fieldDelimiter,uniqueValueInfos:d.clone(this.uniqueValueInfos),visualVariables:d.clone(this.visualVariables)})},collectRequiredFields:function(a){this.inherited(arguments);[this.field,this.field2,this.field3].forEach(function(b){b&&
(a[b]=!0)})},_processUVInfo:function(a){var b=a.value,c=a.symbol;c&&!c.declaredClass&&(a.symbol=e.fromJSON(c));this._symbols[b]=a}});return h});